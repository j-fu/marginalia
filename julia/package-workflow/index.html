<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/marginalia/libs/katex/katex.min.css"> <link rel=stylesheet  href="/marginalia/libs/highlight/github.min.css"> <link rel=stylesheet  href="/marginalia/css/franklin.css"> <link rel=stylesheet  href="/marginalia/css/poole_lanyon.css"> <link rel=stylesheet  href="/marginalia/css/adjust.css"> <link rel=icon  href="/marginalia/assets/favicon.png"> <title>Julia: Package Workflow</title> <input type=checkbox  class=sidebar-checkbox  id=sidebar-checkbox > <div class=sidebar  id=sidebar > <div class=sidebar-item > <p>Marginalia</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/marginalia/">Home</a> <a class="sidebar-nav-item " href="/marginalia/julia/">Julia</a> <a class="sidebar-nav-item " href="/marginalia/git/">Git</a> <a class="sidebar-nav-item " href="/marginalia/older-posts/">Older posts</a> </nav> <div class=sidebar-item > <p>&copy; Jürgen Fuhrmann.</p> </div> </div> <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. --> <div class=wrap > <div class=masthead > <div class=container > <h3 class=masthead-title > <a href="/marginalia/" title=Home >Marginalia</a> </h3> </div> </div> </div> <div class="container content"> <div class=franklin-content ><h1 id=julia_package_workflow ><a href="#julia_package_workflow" class=header-anchor >Julia: Package Workflow</a></h1> <div class=franklin-toc ><ol><li><a href="#some_links">Some links</a><li><a href="#starting_a_package">Starting a package</a><ol><li><a href="#starting_a_package_as_part_of_an_application_project">Starting a package as part of an application project</a><li><a href="#starting_a_package_repository">Starting a package repository</a></ol><li><a href="#tests">Tests</a><li><a href="#continouos_integration">Continouos Integration</a><li><a href="#providing">Providing </a><ol><li><a href="#using_a_package_under_development">Using a package under development</a><li><a href="#registration_of_a_new_package_or_a_new_version_in_a_local_registry">Registration of a new package or a new version in a local registry</a><li><a href="#without_write_access_to_the_registry">Without write access to the registry</a><li><a href="#with_write_access_to_this_repository">With write access to this repository</a><li><a href="#using_the_general_registry">Using the General registry</a><li><a href="#naming_and_versioninga">Naming and versioninga</a></ol></ol></div> <p>This post is work in progress, I hope to add almost all I know about Julia package development.</p> <h2 id=some_links ><a href="#some_links" class=header-anchor >Some links</a></h2> <ul> <li><p>https://medium.com/coffee-in-a-klein-bottle/developing-your-julia-package-682c1d309507</p> <li><p>https://jaantollander.com/post/how-to-create-software-packages-with-julia-language/</p> <li><p>https://www.stochasticlifestyle.com/developing-julia-packages/</p> <li><p>https://medium.com/analytics-vidhya/an-introduction-to-continuous-integration-github-actions-for-julia-1a5a1a6e64d6</p> <li><p>https://sdobber.github.io/juliapackage/</p> </ul> <p>For general terminology, see the <a href="https://pkgdocs.julialang.org/v1/glossary/#Glossary">package manager glossary</a>. According to this, here, we assume that a <em>package</em> is Julia code which is supposed to be used by other projects, applications or packages.</p> <p>When developing Julia packages it is advisable to set the environment variable <a href="https://pkgdocs.julialang.org/v1/api/#Pkg.develop"><code>JULIA_PKG_DEVDIR</code></a> to a reasonable path. All Julia packages under development will reside there, and for a particular package, we refer to its corresponding <code>package_dir</code> during this post.</p> <h2 id=starting_a_package ><a href="#starting_a_package" class=header-anchor >Starting a package</a></h2> <p>See also the <a href="https://pkgdocs.julialang.org/v1/creating-packages/">Pkg documentation</a></p> <h3 id=starting_a_package_as_part_of_an_application_project ><a href="#starting_a_package_as_part_of_an_application_project" class=header-anchor >Starting a package as part of an application project</a></h3> <p>Often, packages evolve during the development of larger application, when it becomes clear that some part of it provides some well defined functionality which can be formulated with its own API. Local packages within an application project allow to start the package development process in such a situation. For this structure, see <a href="/marginalia/julia/project-workflow">my previous post</a>.</p> <h3 id=starting_a_package_repository ><a href="#starting_a_package_repository" class=header-anchor >Starting a package repository</a></h3> <p>Typically, each Julia package resides in its own git repository &#40;other configurations are <a href="https://discourse.julialang.org/t/usage-of-subdirectories-to-store-multiple-packages-in-a-single-repo/55534">possible</a>&#41;.</p> <p>Create an empty repository <code>NewPackageName.jl</code> on a server with <code>git_url</code></p> <pre><code class="julia hljs">$ cd $JULIA_PKG_DEVDIR
$ julia
pkg&gt; generate NewPackageName
julia&gt; exit()
cd NewPackageName
git init
git add remote origin git_url
git add .</code></pre> <p>Julia packages have a fixed structure which includes</p> <ul> <li><p><a href="https://pkgdocs.julialang.org/v1/toml-files/#Project.toml"><code>Project.toml</code></a>: description of dependencies. This also provides the packages with its own environment during development. Furthermore, it contains the uuid used to identify the package and its name, author and version number.</p> <li><p><code>README.md</code>: Short information about the package</p> <li><p><code>LICENSE</code>: License information. Should be one of the <a href="https://opensource.org/licenses">OSI approved</a> open source licenses if the package shall be registered with the Julia General Registry</p> <li><p><code>src</code>: subdirectory containing code</p> <ul> <li><p><code>src/NewPackageName.jl</code>: Julia source file which must contain a module <code>NewPackageName</code> where all package code resides. It may include further source code files.</p> </ul> <li><p><code>test</code>: subdirectory containing test code</p> <ul> <li><p><code>test/runtests.jl</code>: script for running tests</p> <li><p><code>test/Project.toml</code>: environment file containing test only dependencies</p> </ul> <li><p><code>docs</code>: subdirectory containing documentation </p> <ul> <li><p><code>docs/make.jl</code>: script for builidng documentation based on Documenter.jl</p> <li><p><code>docs/Project.toml</code>: environment file containing dependencies for documentation</p> </ul> <li><p>Configuration files for Continuous Integration</p> </ul> <p>A <a href="https://pkgdocs.julialang.org/v1/toml-files/#Project.toml"><code>Manifest.toml</code></a> file is created as soon as the package environment is instantiated. It contains the full metadata of all package dependencies. This file <em>should not be tracked by git</em>. Instead, the <code>Project.toml</code> shall contain a <code>&#91;compat&#93;</code> section which inform the package resolver about the compatibility with different versions of dependencies.</p> <p>Instead of invoking <code>pkg&gt; generate NewPackageName</code>, a more comprehensive initial package structure can be be created by cloning <a href="https://github.com/JuliaLang/Example.jl">Example.jl</a> or with <a href="https://github.com/invenia/PkgTemplates.jl">PkgTemplates.jl</a>. These also create the necessary files for controlling automatic CI tests on github/gitlab.</p> <h2 id=tests ><a href="#tests" class=header-anchor >Tests</a></h2> <p>See also the <a href="https://pkgdocs.julialang.org/v1/creating-packages/#Adding-tests-to-the-package">Pkg documentation</a>.</p> <p>The files in <code>test</code> provide the environment and the code to run tests of the functions implemented in the package. While it is hard to have 100&#37; test coverage of the package functinality, one should strive to achieve this goal. Besides of the obvious reasons of reproducibility, peer pressure etc., sufficient test coverage helps to keep a package author sane. Imagine the need to change something in the package three years after the last serious work on it...</p> <p>It is quite possible that tests have more dependencies than the package itself. Therefore Julia packages have their own test environment in <code>test/Project.toml</code>. The <code>runtests.jl</code> file contains the code for the tests. All code called from the <a href="https://docs.julialang.org/en/v1/stdlib/Test/#Test.@test"><code>@test</code></a> macro is part of the test coverage.</p> <p>Tests code can be called in different ways. In the package root environment:</p> <pre><code class="julia hljs">julia&gt; Pkg.test()</code></pre>
<p>or</p>
<pre><code class="julia hljs">] test</code></pre>
<p>In any environment with the package added: </p>
<pre><code class="julia hljs">julia&gt; Pkg.test(<span class=hljs-string >&quot;MyPackageName&quot;</span>)</code></pre>
<p>or</p>
<pre><code class="julia hljs">] test MyPackageName</code></pre>
<h2 id=continouos_integration ><a href="#continouos_integration" class=header-anchor >Continouos Integration</a></h2>
<p>Your package tests sucessfully run on your linux laptop. But how can you be sure that they also run on Mac and Windows ? And, you want to show off with a good test coverage helping to build up trust in your work.</p>
<p>The solution ?  Run your tests on different systems via <a href="https://github.com/features/actions">github actions</a> and <a href="https://docs.github.com/en/actions/monitoring-and-troubleshooting-workflows/adding-a-workflow-status-badge">show off</a> the result. Alternatively, this can be done on <a href="https://discourse.julialang.org/t/julia-and-gitlab-self-hosted-a-state-of-the-art/86685">gitlab</a> as well.</p>
<h2 id=providing ><a href="#providing" class=header-anchor >Providing </a></h2>
<h3 id=using_a_package_under_development ><a href="#using_a_package_under_development" class=header-anchor >Using  a package under development</a></h3>
<p>While the package is unregistered you can add it to the environment of a project:</p>
<pre><code class="julia hljs">$ cd project_dir
$ julia --project=@.
pkg&gt; add git_url</code></pre>
<p>In this case, the version in the git repository on the server is used via a shallow clone &#40;clone without versioning information&#41; created in <code>&#36;HOME/.julia/packages</code>. If you use</p>
<pre><code class="julia hljs">pkg&gt; dev git_url</code></pre>
<p>instead, a full clone is created in <code>&#36;JULIA_PKG_DEVDIR</code> and used. If the corresponding subdirectory in <code>JULIA_PKG_DEVDIR</code> does not exist, it will be checked out from <code>git_url</code>. The same would happen with registered packages added by name.</p>
<h3 id=registration_of_a_new_package_or_a_new_version_in_a_local_registry ><a href="#registration_of_a_new_package_or_a_new_version_in_a_local_registry" class=header-anchor >Registration of a new package or a new version in a local registry</a></h3>
<p>We assume to speak about <code>MyRegistry</code> as an example, but generally this is true for all registries. </p>
<h3 id=without_write_access_to_the_registry ><a href="#without_write_access_to_the_registry" class=header-anchor >Without write access to the registry</a></h3>
<p>Send an  email to  one of  the admins  containing the  git url  of the corresponding repository singnaling the advance of a new version.  The <code>Project.toml</code> file already should contain the new version number.</p>
<h3 id=with_write_access_to_this_repository ><a href="#with_write_access_to_this_repository" class=header-anchor >With write access to this repository</a></h3>
<p>Add the <a href="https://github.com/GunnarFarneback/LocalRegistry.jl">LocalRegistry.jl</a> package to your environment</p>
<pre><code class="julia hljs">pkg&gt;  add LocalRegistry</code></pre>
<p>For a new package <code>X.jl</code> or a new version thereof, first obtain a clone, either by checking it out via its url, or by adding it to the environment, getting into develop mode and updating it:</p>
<pre><code class="julia hljs">pkg&gt; add X
pkg&gt; develop X
pkg&gt; update X <span class=hljs-comment ># not clear if really necessary</span></code></pre>
<p>Then, you will be able to register a new version based on the updated version number in <code>Project.toml</code>:</p>
<pre><code class="julia hljs">julia&gt; <span class=hljs-keyword >using</span> X
julia&gt; <span class=hljs-keyword >using</span> LocalRegistry
julia&gt; LocalRegistry.register(X,<span class=hljs-string >&quot;MyRegistry&quot;</span>,push=<span class=hljs-literal >true</span>)</code></pre>
<p>This assumes that the remote origin of the local clone in <code>.julia/registries/MyRegistry</code> has been modified to <code>git@github.com:me/MyRegistry</code>. The <code>push&#61;true</code> can be omitted, in this case, <code>LocalRegistry.Register</code> results in a commit to the local copy which you can push later.</p>
<p>After this, do not forget to create a tag in your repository marking the version <code>x.y.z</code> of the package:</p>
<pre><code class="julia hljs">$ git tag vx.y.z</code></pre>
<h3 id=using_the_general_registry ><a href="#using_the_general_registry" class=header-anchor >Using the General registry</a></h3>
<p>Registring packages in the general registry assumes full compliance to a number of rules:</p>
<ul>
<li><p>Package is deployed with automatic testing on github &#40;at least this is the current practice&#41; with <a href="https://juliadocs.github.io/Documenter.jl/stable/man/hosting/index.html">travis, deploydocs etc. enabled</a></p>

<li><p>Don&#39;t forget compat info for  julia and all packages  in Project.toml</p>

<li><p>Proper versioning sequence</p>

<li><p>Must wait 3 days for merge for  new package</p>

<li><p>Must wait <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.48312em;vertical-align:0em;"></span><span class=mrel >≈</span></span></span></span> 1 hour for new version</p>

</ul>
<p>All of this is automatically handeled by the <a href="https://github.com/JuliaRegistries/Registrator.jl">JuliaRegistrator</a></p>

<div class=img-small >
<img src="https://raw.githubusercontent.com/JuliaRegistries/Registrator.jl/master/graphics/logo.png">
</div>

<p>It needs to be installed as a github app in for the package repository.</p>
<h3 id=naming_and_versioninga ><a href="#naming_and_versioninga" class=header-anchor >Naming and versioninga</a></h3>
<ul>
<li><p>Registration in the general registry starts with version 0.1.0, all deviations from this will create extra work upon registration in the general registry.</p>

<li><p>Start registration Registering with JuliaEgistrator</p>

<li><p>Either name a &quot;budding package&quot; &#40;e.g. Ants.jl&#41; accordingly: AntsPrototype.jl, Ants0.jl  have a version number conventiom.</p>

</ul>
<div class=page-foot >
  <div class=copyright >
    &copy; Jürgen Fuhrmann. License: <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode"> CC-BY-SA 4.0</a>. Last modified: December 07, 2022. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
Upon finding factual errors, typos etc. <a href=https://github.com/j-fu/marginalia/issues> raise an issue<a>.
<center>  <a href="/marginalia/feed.xml"> <img src="/marginalia/assets/rss.png" style="width:100px;"></a> </center>
  </div>
</div>


</div>
      </div>  
    </div> 
    
        



    
    
        


    
    <label for=sidebar-checkbox  class=sidebar-toggle ></label>