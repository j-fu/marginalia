<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/marginalia/libs/katex/katex.min.css"> <link rel=stylesheet  href="/marginalia/libs/highlight/github.min.css"> <link rel=stylesheet  href="/marginalia/css/franklin.css"> <link rel=stylesheet  href="/marginalia/css/poole_lanyon.css"> <link rel=stylesheet  href="/marginalia/css/adjust.css"> <link rel=icon  href="/marginalia/assets/favicon.png"> <title>Package development</title> <input type=checkbox  class=sidebar-checkbox  id=sidebar-checkbox > <div class=sidebar  id=sidebar > <div class=sidebar-item > <p>Marginalia</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/marginalia/">Home</a> <a class="sidebar-nav-item " href="/marginalia/julia/">Julia</a> <a class="sidebar-nav-item " href="/marginalia/older-posts/">Older posts</a> </nav> <div class=sidebar-item > <p>&copy; Jürgen Fuhrmann.</p> </div> </div> <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. --> <div class=wrap > <div class=masthead > <div class=container > <h3 class=masthead-title > <a href="/marginalia/" title=Home >Marginalia</a> </h3> </div> </div> </div> <div class="container content"> <div class=franklin-content ><p>Example.jl PkgTemplates.jl</p> <h2 id=package_development ><a href="#package_development" class=header-anchor >Package development</a></h2> <p>Here we assume that a <em>package</em> is Julia code which resides in a given <code>package_dir</code> and is supposed to be used by other projects or packages. When developing Julia packages it is advisable to set the environment variable <code>JULIA_PKG_DEVDIR</code> to reasonable path. All Julia packages under development should reside there.</p> <h3 id=starting_a_package ><a href="#starting_a_package" class=header-anchor >Starting a package</a></h3> <p>Create empty repo <code>NewPackageName.jl</code> on server with <code>git_url</code></p> <pre><code class="julia hljs">$ cd JULIA_PKG_DEVDIR
$ julia
pkg&gt; generate NewPackageName
julia&gt; exit()
cd NewPackageName
git init
git add remote origin git_url
git add .</code></pre> <p>Julia packages have a fixed structure which includes</p> <ul> <li><p><code>Project.toml</code>: description of dependencies. This also provides the packages with its own environment during development. Furthermore, it contains the uuid used to identify the package and its name, author and version number.</p> <li><p><code>src</code>: subdirectory containing code</p> <ul> <li><p><code>src/NewPackageName.jl</code>: Julia source file which must contain a module <code>NewPackageName</code></p> </ul> <li><p><code>test</code>: subdirectory containing test code</p> <ul> <li><p><code>test/runtests.jl</code>: script for running tests</p> </ul> <li><p><code>docs</code>: subdirectory containing documentation </p> <ul> <li><p><code>docs/make.jl</code>: script for builidng documentation based on Documenter.jl</p> </ul> </ul> <h3 id=using_a_package_under_development ><a href="#using_a_package_under_development" class=header-anchor >Using a package under development</a></h3> <p>While the package is unregistered you can add it to the environment of a project:</p> <pre><code class="julia hljs">$ cd project_dir
$ julia --project=@.
pkg&gt; add git_url</code></pre> <p>In this case, the version in the git repository on the server is used via a shallow clone &#40;clone without versioning information&#41; created in <code>&#36;HOME/.julia/packages</code>. If you use</p> <pre><code class="julia hljs">pkg&gt; dev git_url</code></pre>
<p>instead, a full clone is created in <code>&#36;JULIA_PKG_DEVDIR</code> and used. If the corresponding subdirectory in <code>JULIA_PKG_DEVDIR</code> does not exist, it will be checked out from <code>git_url</code>. The same would happen with registered packages added by name.</p>
<h2 id=registration_of_a_new_package_or_a_new_version ><a href="#registration_of_a_new_package_or_a_new_version" class=header-anchor >Registration of a new package or a new version</a></h2>
<p>We assume to speak about <code>WIASJuliaRegistry</code> as an example, but generally this is true for all registries. </p>
<h3 id=without_write_access_to_this_repository ><a href="#without_write_access_to_this_repository" class=header-anchor >Without write access to this repository</a></h3>
<p>Send an  email to  one of  the admins  containing the  git url  of the corresponding repository singnaling the advance of a new version.  The <code>Project.toml</code> file already should contain the new version number.</p>
<h3 id=with_write_access_to_this_repository ><a href="#with_write_access_to_this_repository" class=header-anchor >With write access to this repository</a></h3>
<p>Add the <a href="https://github.com/GunnarFarneback/LocalRegistry.jl">LocalRegistry.jl</a> package to your environment</p>
<pre><code class="julia hljs">pkg&gt;  add LocalRegistry</code></pre>
<p>For a new package <code>X.jl</code> or a new version thereof, first obtain a clone, either by checking it out via its url, or by adding it to the environment, getting into develop mode and updating it:</p>
<pre><code class="julia hljs">pkg&gt; add X
pkg&gt; develop X
pkg&gt; update X <span class=hljs-comment ># not clear if really necessary</span></code></pre>
<p>Then, you will be able to register a new version based on the updated version number in <code>Project.toml</code>:</p>
<pre><code class="julia hljs">julia&gt; <span class=hljs-keyword >using</span> X
julia&gt; <span class=hljs-keyword >using</span> LocalRegistry
julia&gt; LocalRegistry.register(X,<span class=hljs-string >&quot;WIASJuliaRegistry&quot;</span>,push=<span class=hljs-literal >true</span>)</code></pre>
<p>This assumes that the remote origin of the local clone in <code>.julia/registries/WIASJuliaRegistry</code> has been modified to <code>git@github.com:WIAS-BERLIN/WIASJuliaRegistry</code>. The <code>push&#61;true</code> can be omitted, in this case, <code>LocalRegistry.Register</code> results in a commit to the local copy which you can push later.</p>
<p>After this, do not forget to create a tag in your repository marking the version <code>x.y.z</code> of the package:</p>
<pre><code class="julia hljs">$ git tag vx.y.z</code></pre>
<h2 id=using_the_general_registry ><a href="#using_the_general_registry" class=header-anchor >Using the General registry</a></h2>
<p>Registring packages in the general registry assumes full compliance to a number of rules:</p>
<ul>
<li><p>Package is deployed with automatic testing on github &#40;at least this is the current practice&#41; with <a href="https://juliadocs.github.io/Documenter.jl/stable/man/hosting/index.html">travis, deploydocs etc. enabled</a></p>

<li><p>Don&#39;t forget compat info for  julia and all packages  in Project.toml</p>

<li><p>Proper versioning sequence</p>

<li><p>Must wait 3 days for merge for  new package</p>

<li><p>Must wait <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.48312em;vertical-align:0em;"></span><span class=mrel >≈</span></span></span></span> 1 hour for new version</p>

</ul>
<p>All of this is automatically handeled by the <a href="https://github.com/JuliaRegistries/Registrator.jl">JuliaRegistrator</a></p>
<p>&lt;img src&#61;&quot;https://raw.githubusercontent.com/JuliaRegistries/Registrator.jl/master/graphics/logo.png&quot; width&#61;200&gt;</p>
<p>It needs to be installed as a github app in for the package repository.</p>
<div class=page-foot >
  <div class=copyright >
    &copy; Jürgen Fuhrmann. License: CC-BY-SA 4.0. Last modified: November 13, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
Upon finding factual errors, typos etc. <a href=https://github.com/j-fu/marginalia/issues> raise an issue<a>.
  </div>
</div>
</div>
      </div>  
    </div> 
    
        



    
    
        


    
    <label for=sidebar-checkbox  class=sidebar-toggle ></label>