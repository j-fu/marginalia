<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/marginalia/libs/highlight/github.min.css"> <link rel=stylesheet  href="/marginalia/css/franklin.css"> <link rel=stylesheet  href="/marginalia/css/poole_lanyon.css"> <link rel=stylesheet  href="/marginalia/css/adjust.css"> <link rel=icon  href="/marginalia/assets/favicon.png"> <title>File differencing for numerical output</title> <input type=checkbox  class=sidebar-checkbox  id=sidebar-checkbox > <div class=sidebar  id=sidebar > <div class=sidebar-item > <p>Marginalia</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/marginalia/">Home</a> <a class="sidebar-nav-item " href="/marginalia/julia/">Julia</a> <a class="sidebar-nav-item " href="/marginalia/git/">Git</a> <a class="sidebar-nav-item " href="/marginalia/older-posts/">Older posts</a> </nav> <div class=sidebar-item > <p>&copy; Jürgen Fuhrmann.</p> </div> </div> <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. --> <div class=wrap > <div class=masthead > <div class=container > <h3 class=masthead-title > <a href="/marginalia/" title=Home >Marginalia</a> </h3> </div> </div> </div> <div class="container content"> <div class=franklin-content ><h1 id=file_differencing_for_numerical_output ><a href="#file_differencing_for_numerical_output" class=header-anchor >File differencing for numerical output</a></h1> <p>&#40;2014-11-10&#41;</p> <p>In software unit tests we have the problem that the usual diff command fails when comparing output files generated by numerical algorithms. Tolerable numerical differences in the output are still hard differnces. <a href="http://www.nongnu.org/numdiff/">Numdiff</a> may help.</p> <p>It is free software and it source code can be downloaded from <a href="http://savannah.nongnu.org/download/numdiff">http://savannah.nongnu.org/download/numdiff</a>.</p> <p>Among other features it allows to compare numbers in output files with a given tolerance.</p> <h2 id=example ><a href="#example" class=header-anchor >Example</a></h2> <p>Assume we have two files: <code>a.txt</code></p> <pre><code class="julia hljs">x=<span class=hljs-number >3.150303334</span>
y=<span class=hljs-number >4.59993e-3</span></code></pre> <p>and <code>b.txt</code></p> <pre><code class="julia hljs">x=<span class=hljs-number >3.15030333</span>
y=<span class=hljs-number >4.59994e-3</span></code></pre> <p>We assume that the differences are tolerably small, and we want to have a differencing tool which acknowledges this. But this is the output of the system <code>diff</code> command:</p> <pre><code class="julia hljs">$ <span class=hljs-keyword >if</span> diff a.txt b.txt ; then echo EQUAL ; <span class=hljs-keyword >else</span> echo DIFFER ; fi
<span class=hljs-number >1</span>,<span class=hljs-number >2</span>c1,<span class=hljs-number >2</span>
&lt; x=<span class=hljs-number >3.150303334</span>
&lt; y=<span class=hljs-number >4.59993e-3</span>
---
&gt; x=<span class=hljs-number >3.15030333</span>
&gt; y=<span class=hljs-number >4.59994e-3</span>
DIFFER</code></pre> <p>With <code>numdiff</code> we can do the following:</p> <pre><code class="julia hljs">$ numdiff a.txt b.txt
----------------
<span class=hljs-comment >##1       #:1   &lt;== x=3.150303334</span>
<span class=hljs-comment >##1       #:1   ==&gt; x=3.15030333</span>
@                                                     @@
----------------
<span class=hljs-comment >##2       #:1   &lt;== y=4.59993e-3</span>
<span class=hljs-comment >##2       #:1   ==&gt; y=4.59994e-3</span>
@                                                     @@

+++  File <span class=hljs-string >&quot;a.txt&quot;</span> differs from file <span class=hljs-string >&quot;b.txt&quot;</span></code></pre> <p>Ok, we had this. So let us introduce the &#40;relative&#41; tolerance:</p> <pre><code class="julia hljs">$ numdiff -r <span class=hljs-number >1.0e-3</span> a.txt b.txt
----------------
<span class=hljs-comment >##1       #:1   &lt;== x=3.150303334</span>
<span class=hljs-comment >##1       #:1   ==&gt; x=3.15030333</span>
@                                                     @@
----------------
<span class=hljs-comment >##2       #:1   &lt;== y=4.59993e-3</span>
<span class=hljs-comment >##2       #:1   ==&gt; y=4.59994e-3</span>
@                                                     @@

+++  File <span class=hljs-string >&quot;a.txt&quot;</span> differs from file <span class=hljs-string >&quot;b.txt&quot;</span></code></pre> <p>Ups? Ok. The manual says:</p> <pre><code class="julia hljs">-s, --separators=IFS

   Specify the set of characters  to use as delimiters <span class=hljs-keyword >while</span> splitting
   the  input lines  into fields  (The  default set  of delimiters  is
   space, tab and newline).  If IFS is prefixed with <span class=hljs-number >1</span>: or <span class=hljs-number >2</span>: then use
   the given  delimiter set only <span class=hljs-keyword >for</span>  the lines from the  first or the
   second file respectively</code></pre> <p>So we should add <code>&#61;</code> to the delimiter list:</p> <pre><code class="julia hljs">$ numdiff -s <span class=hljs-string >&quot;\n =&quot;</span>  -r <span class=hljs-number >1.0e-5</span> a.txt b.txt 

+++  Files <span class=hljs-string >&quot;a.txt&quot;</span> and <span class=hljs-string >&quot;b.txt&quot;</span> are equal</code></pre> <p>This is what we expected.</p> <p>A stronger tolerance gives:</p> <pre><code class="julia hljs">$ numdiff -s <span class=hljs-string >&quot;\n =&quot;</span>  -r <span class=hljs-number >1.0e-16</span> a.txt b.txt 
----------------
<span class=hljs-comment >##1       #:2   &lt;== 3.150303334</span>
<span class=hljs-comment >##1       #:2   ==&gt; 3.15030333</span>
@ Absolute error = <span class=hljs-number >4.0000000000e-9</span>, Relative error = <span class=hljs-number >1.2697190019e-9</span>
----------------
<span class=hljs-comment >##2       #:2   &lt;== 4.59993e-3</span>
<span class=hljs-comment >##2       #:2   ==&gt; 4.59994e-3</span>
@ Absolute error = <span class=hljs-number >1.0000000000e-8</span>, Relative error = <span class=hljs-number >2.1739461253e-6</span>

+++  File <span class=hljs-string >&quot;a.txt&quot;</span> differs from file <span class=hljs-string >&quot;b.txt&quot;</span></code></pre> <p>Very informative. Note that the return code from <code>numdiff</code> can be used as with <code>diff</code> &#40;see above&#41; for reacting on the various results.</p> <div class=page-foot > <div class=copyright > &copy; Jürgen Fuhrmann. License: <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode"> CC-BY-SA 4.0</a>. Last modified: December 02, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. Upon finding factual errors, typos etc. <a href=https://github.com/j-fu/marginalia/issues> raise an issue<a>. </div> </div> </div> </div> </div> <label for=sidebar-checkbox  class=sidebar-toggle ></label>