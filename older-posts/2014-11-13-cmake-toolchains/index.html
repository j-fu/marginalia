<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/marginalia/libs/highlight/github.min.css"> <link rel=stylesheet  href="/marginalia/css/franklin.css"> <link rel=stylesheet  href="/marginalia/css/poole_lanyon.css"> <link rel=stylesheet  href="/marginalia/css/adjust.css"> <link rel=icon  href="/marginalia/assets/favicon.png"> <title>Changing compilers, flags etc. in cmake</title> <input type=checkbox  class=sidebar-checkbox  id=sidebar-checkbox > <div class=sidebar  id=sidebar > <div class=sidebar-item > <p>Marginalia</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/marginalia/">Home</a> <a class="sidebar-nav-item " href="/marginalia/julia/">Julia</a> <a class="sidebar-nav-item " href="/marginalia/git/">Git</a> <a class="sidebar-nav-item " href="/marginalia/older-posts/">Older posts</a> </nav> <div class=sidebar-item > <p>&copy; Jürgen Fuhrmann.</p> </div> </div> <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. --> <div class=wrap > <div class=masthead > <div class=container > <h3 class=masthead-title > <a href="/marginalia/" title=Home >Marginalia</a> </h3> </div> </div> </div> <div class="container content"> <div class=franklin-content ><h1 id=changing_compilers_flags_etc_in_cmake ><a href="#changing_compilers_flags_etc_in_cmake" class=header-anchor >Changing compilers, flags etc. in cmake</a></h1> <ul> <li><p>2022-09-09: Updated links etc. </p> <li><p>2021-11-11: Transfer to franklin&#43;github.io</p> <li><p>2014-11-10: Initial version</p> </ul> <p>CMake does a great job in auto-detecting your system. But what to do if you want to be in control of the choice of compilers, flags etc ? Use toolchain files.</p> <h2 id=resources ><a href="#resources" class=header-anchor >Resources</a></h2> <p>The start of my cmake remarks is <a href="/marginalia/older-posts/2014-10-30-cmake">here</a>.</p> <p>Please consider the discussion on <a href="https://cmake.org/cmake/help/book/mastering-cmake/chapter/Cross&#37;20Compiling&#37;20With&#37;20CMake.html">cross compiling</a> on the cmake home page. Using this approach I was able to cross-compile code for Windows &#40;via <a href="http://www.mingw.org/">mingw</a> on Linux, including GUI &#40;<a href="http://www.fltk.org">fltk</a>&#41; and OpenGL.</p> <h2 id=how_to_work_with_toolchain_files ><a href="#how_to_work_with_toolchain_files" class=header-anchor >How to work with toolchain files</a></h2> <p>The basic approach is to split your CMake system into two parts:</p> <ul> <li><p>one generic &#40;wrt. system&#41; part which describes your project</p> <li><p>one system specific part which describes the compiler etc.</p> </ul> <p>For an example, we set up a second version of our project in <a href="/marginalia/assets/tinyproject2.zip">tinyproject2.zip</a> by just adding one file to it, let us call it <code>intel.cmake</code>.</p> <p>It contains</p> <pre><code class="julia hljs">set(CMAKE_SYSTEM_NAME Linux)
set(CMAKE_COMPILER_VENDOR <span class=hljs-string >&quot;intel&quot;</span>)

set(CMAKE_C_COMPILER icc)
set(CMAKE_C_FLAGS <span class=hljs-string >&quot;-O3 &quot;</span> CACHE STRING <span class=hljs-string >&quot;&quot;</span> FORCE)</code></pre> <p>Now, we do the standard out-of-source build thing with one modification:</p> <pre><code class="julia hljs">$ mkdir build
$ cd build
$ cmake -DCMAKE_TOOLCHAIN_FILE=../intel.cmake ..
$ cd ..
$ make -C build
$ .build/hello
Hello world, the answer is <span class=hljs-number >42</span>!</code></pre> <p>During the cmake run you should see that cmake detects the intel compiler and then uses it.</p> <p>Please note, that due to the out-of-source work flow it is very easy to work in parallel on different versions, e.g.</p> <pre><code class="julia hljs">gnu-dbg
gnu-opt
intel-dbg
intel-opt</code></pre> <p>etc. Each has its own toolchain file and build directory.</p> <div class=page-foot > <div class=copyright > &copy; Jürgen Fuhrmann. License: <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode"> CC-BY-SA 4.0</a>. Last modified: October 17, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. Upon finding factual errors, typos etc. <a href=https://github.com/j-fu/marginalia/issues> raise an issue<a>. <center> <a href="/marginalia/feed.xml"> <img src="/marginalia/assets/rss.png" style="width:100px;"></a> </center> </div> </div> </div> </div> </div> <label for=sidebar-checkbox  class=sidebar-toggle ></label>