<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/marginalia/libs/highlight/github.min.css"> <link rel=stylesheet  href="/marginalia/css/franklin.css"> <link rel=stylesheet  href="/marginalia/css/poole_lanyon.css"> <link rel=stylesheet  href="/marginalia/css/adjust.css"> <link rel=icon  href="/marginalia/assets/favicon.png"> <title>Bringing Fortran, C and C&#43;&#43; together</title> <input type=checkbox  class=sidebar-checkbox  id=sidebar-checkbox > <div class=sidebar  id=sidebar > <div class=sidebar-item > <p>Marginalia</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/marginalia/">Home</a> <a class="sidebar-nav-item " href="/marginalia/julia/">Julia</a> <a class="sidebar-nav-item " href="/marginalia/older-posts/">Older posts</a> </nav> <div class=sidebar-item > <p>&copy; Jürgen Fuhrmann.</p> </div> </div> <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. --> <div class=wrap > <div class=masthead > <div class=container > <h3 class=masthead-title > <a href="/marginalia/" title=Home >Marginalia</a> </h3> </div> </div> </div> <div class="container content"> <div class=franklin-content ><h1 id=bringing_fortran_c_and_c_together ><a href="#bringing_fortran_c_and_c_together" class=header-anchor >Bringing Fortran, C and C&#43;&#43; together</a></h1> <p>&#40;2014-11-13&#41;</p> <p>Most compiler suites come today with the &#40;not so&#41; holy trinity of widespread compiled languages: Fortran, C and C&#43;&#43;. Here are some remarks on using them together.</p> <p>Disclaimer: On the Fortran side, this is mostly about Fortran77/95. Modern Fortran has more tools for this. So, this information might be useful for interfacing legacy code.</p> <h2 id=ways_of_passing_of_data_to_subroutines ><a href="#ways_of_passing_of_data_to_subroutines" class=header-anchor >Ways of passing of data to subroutines</a></h2> <ul> <li><p>C: C has two options to pass data: by value and by address. Obviously, if we want to interface with Fortran, we can us only passing by address Thus, we can have</p> </ul> <pre><code class="julia hljs">void abc(int x) /* by value*/
void abc(int *x) /* by address*/</code></pre> <ul> <li><p>Fortran: Fortran77 passes all data by address, unless some extensions are used which are not really portable.</p> </ul> <pre><code class="julia hljs">c      passing a scalar:
       subroutine abc(x)
	   integer x

c      passing an array: 
       subroutine abc(x)
	   integer x
	   dimendsion x(<span class=hljs-number >10</span>)</code></pre> <ul> <li><p>C&#43;&#43; has three options: by value, by address and by reference:</p> </ul> <pre><code class="julia hljs">void abc(int x) // by value
void abc(int *x) // by address
void abc(int &amp;x) // by reference</code></pre> <p>So, the lowest common denominator between C,C&#43;&#43; and Fortran is passing by address, and the lowest common denominator between C and C&#43;&#43; is passing by address or by value.</p> <h2 id=name_mangling ><a href="#name_mangling" class=header-anchor >Name mangling</a></h2> <p>Linking together compilation units from different languages creates the need to identify &quot;linker symbols&quot; created by the different languages from the same name in the source code. The same name shows up differently.</p> <p>The name <code>abc</code> is transformed to</p> <ul> <li><p>Fortran: <code>abc_</code> &#40;on most unices&#41; or <code>ABC_</code> or <code>abc</code> or <code>ABC</code></p> <li><p>C: abc</p> <li><p>C&#43;&#43; <code>_Z3abci</code> &#40;by value&#41; or <code>_Z3abcRi</code> &#40;by reference&#41; or <code>_Z3abcPi</code> &#40;by address&#41;</p> </ul> <h2 id=how_to_solve ><a href="#how_to_solve" class=header-anchor >How to solve:</a></h2> <ul> <li><p>F77 Macro form CMake</p> <li><p><code>extern &quot;C&quot;</code> in C&#43;&#43;</p> </ul> <div class=page-foot > <div class=copyright > &copy; Jürgen Fuhrmann. Last modified: November 13, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div> </div> </div> <label for=sidebar-checkbox  class=sidebar-toggle ></label>